<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Hand Detection</title>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.10/lib/p5.js"></script>
    <script src="https://unpkg.com/ml5@1/dist/ml5.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #111;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        canvas {
            border: 2px solid rgb(255, 255, 0);
        }
    </style>
</head>

<body>
    <script>
        let video;
        let handpose;
        let hands = [];

        // P5.js preload function (do not change the name)
        function preload() {
            handPose = ml5.handPose({ flipped: true });
        }

        // P5.js setup function (do not change the name)
        function setup() {
            createCanvas(640, 480);
            video = createCapture(VIDEO, { flipped: true });
            video.size(width, height);
            video.hide();

            circleX = width / 2;
            circleY = height / 2;

            // Start detecting hands from the webcam video
            handPose.detectStart(video, gotHands);
        }

        // This function is called every time ther is an update from the model
        function gotHands(results) {
            // Save the output to the hands variable
            hands = results;
            //console.log(hands);
        }


        let circleX;
        let circleY;
        let smoothing = 0.2; // Adjust this value for more or less smoothing

        // P5.js draw loop (do not change the name, no requestAnimationFrame)
        function draw() {
            // paint the Canvas background
            background(220);

            // Draw the video feed (with a smoothing effect)
            image(video, 0, 0, width, height);
            // semi-transparent white overlay
            fill(255, 255, 255, 100);
            rect(0, 0, width, height);

            //  Update rectangle position based on hand detection
            if (hands.length > 0) {
                let hand = hands[0]; // Get the first detected hand
                // Index finger tip = keypoint 8
                let indexFingerTip = hand.index_finger_tip;

                // Draw a circle at the fingertip
                fill(255, 0, 0);
                circle(indexFingerTip.x, indexFingerTip.y, 20);

                // Smoothly interpolate the circle's position towards the index finger tip
                circleX += (indexFingerTip.x - circleX) * smoothing;
                circleY += (indexFingerTip.y - circleY) * smoothing;
            }
            // always draw the circle at its new interpolated position
            fill(0, 0, 255);
            circle(circleX, circleY, 10);
        }
    </script>
</body>

</html>